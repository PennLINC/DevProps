---
title: "Untitled"
author: "Adam"
date: "9/13/2021"
output: html_document
---

```{r}
library(stringr)
library(gtools)
library(ggplot2)
# aggregate basis time series peak sequences, parse, viz frequencies
```

```{r}
# derive all possible sequences of X length for this granularity
Seqs=permutations(n=4,r=4,v=1:4,repeats.allowed = F)
# adjust so 0 is included
Seqs=(Seqs-1)
# initialize cross-subject sequence count dataframe: one row for each possibility
seqCount=rep(0,dim(Seqs)[1])
# get Subj List, "Subjs" from DataVolPhenoRelations at the moment
# for each subj
for (p in 1:length(Subjs)){
subj=Subjs[p]
# For each task
tasks = c('rest','SST','nback','MID')

# but not really for each task, just for rest RN
for (i in 1){
  # peak sequence
  pSfn=paste0('/cbica/projects/abcdfnets/results/wave_output/',subj,'/',subj,'_',tasks[i],'_PeakSeq')
  peakSeq=read.delim(pSfn,header=F)
  TRfn=paste0('/cbica/projects/abcdfnets/results/wave_output/',subj,'/',subj,'_',tasks[i],'_TRSeq')
  trSeq=read.delim(TRfn,header=F)
  # convert to string for string searching
  strungPeakSeqs<-toString(peakSeq)
  # clean out \n's
  strungPeakSeqs<-gsub('\n','',strungPeakSeqs)
  # counts sequences
  for (S in 1:dim(Seqs)[1]){
    InstanceCount=str_count(strungPeakSeqs,pattern=toString(Seqs[S,]))
    seqCount[S]=seqCount[S]+InstanceCount
  }
}
# end each task
}
# end each sub
seqCountDF<-data.frame(seqCount)
seqCountDF$Sequence=NULL
# insert actual sequences for plotting
for (S in 1:dim(Seqs)[1]){
  seqCountDF$Sequence[S]=paste0(toString(Seqs[S,]))
  }
ggplot(seqCountDF)+geom_point(aes(Sequence,seqCount),size=3)+theme_minimal(base_size=30)+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```